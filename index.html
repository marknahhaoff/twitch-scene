<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sc√®ne Interactive Twitch</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simulation du stockage pour GitHub Pages
        window.storage = {
            async get(key) {
                const data = localStorage.getItem(key);
                return data ? { key, value: data, shared: true } : null;
            },
            async set(key, value, shared) {
                localStorage.setItem(key, value);
                return { key, value, shared: true };
            },
            async delete(key, shared) {
                localStorage.removeItem(key);
                return { key, deleted: true, shared };
            },
            async list(prefix, shared) {
                const keys = Object.keys(localStorage).filter(k => !prefix || k.startsWith(prefix));
                return { keys, prefix, shared };
            }
        };

        // Ic√¥nes Lucide simplifi√©es
        const Plus = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Check = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;
        const Trash2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const Sun = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>;
        const Cloud = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>;
        const CloudRain = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="16" y1="13" x2="16" y2="21"/><line x1="8" y1="13" x2="8" y2="21"/><line x1="12" y1="15" x2="12" y2="23"/><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"/></svg>;
        const CloudSnow = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 17.58A5 5 0 0 0 18 8h-1.26A8 8 0 1 0 4 16.25"/><line x1="8" y1="16" x2="8.01" y2="16"/><line x1="8" y1="20" x2="8.01" y2="20"/><line x1="12" y1="18" x2="12.01" y2="18"/><line x1="12" y1="22" x2="12.01" y2="22"/><line x1="16" y1="16" x2="16.01" y2="16"/><line x1="16" y1="20" x2="16.01" y2="20"/></svg>;
        const Wind = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg>;
        const Smile = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>;
        const Frown = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>;
        const Meh = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="8" y1="15" x2="16" y2="15"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>;
        const Coffee = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>;

        function TwitchScene() {
            const [tasks, setTasks] = useState([]);
            const [weather, setWeather] = useState([]);
            const [moods, setMoods] = useState([]);
            const [newTask, setNewTask] = useState('');
            const [username, setUsername] = useState('');
            const [isFollower, setIsFollower] = useState(false);
            const [selectedWeather, setSelectedWeather] = useState('');
            const [selectedMood, setSelectedMood] = useState('');
            const [loading, setLoading] = useState(true);

            const weatherOptions = [
                { id: 'soleil', label: 'Soleil', icon: Sun, color: 'text-yellow-400' },
                { id: 'nuageux', label: 'Nuageux', icon: Cloud, color: 'text-gray-400' },
                { id: 'pluie', label: 'Pluie', icon: CloudRain, color: 'text-blue-400' },
                { id: 'neige', label: 'Neige', icon: CloudSnow, color: 'text-blue-200' },
                { id: 'vent', label: 'Venteux', icon: Wind, color: 'text-gray-300' }
            ];

            const moodOptions = [
                { id: 'heureux', label: 'Heureux', icon: Smile, color: 'text-green-400' },
                { id: 'triste', label: 'Triste', icon: Frown, color: 'text-blue-400' },
                { id: 'fatigue', label: 'Fatigu√©', icon: Coffee, color: 'text-orange-400' },
                { id: 'neutre', label: 'Neutre', icon: Meh, color: 'text-gray-400' }
            ];

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const tasksResult = await window.storage.get('tasks');
                    const weatherResult = await window.storage.get('weather');
                    const moodsResult = await window.storage.get('moods');

                    if (tasksResult) setTasks(JSON.parse(tasksResult.value));
                    if (weatherResult) setWeather(JSON.parse(weatherResult.value));
                    if (moodsResult) setMoods(JSON.parse(moodsResult.value));
                } catch (error) {
                    console.log('Premi√®re utilisation, donn√©es initialis√©es');
                }
                setLoading(false);
            };

            const saveData = async (key, data) => {
                try {
                    await window.storage.set(key, JSON.stringify(data), true);
                } catch (error) {
                    console.error('Erreur sauvegarde:', error);
                }
            };

            const addTask = async () => {
                if (!newTask.trim() || !username.trim() || !isFollower) return;
                
                const task = {
                    id: Date.now(),
                    text: newTask,
                    author: username,
                    completed: false
                };
                
                const updatedTasks = [...tasks, task];
                setTasks(updatedTasks);
                await saveData('tasks', updatedTasks);
                setNewTask('');
            };

            const toggleTask = async (id) => {
                const updatedTasks = tasks.map(t => 
                    t.id === id ? { ...t, completed: !t.completed } : t
                );
                setTasks(updatedTasks);
                await saveData('tasks', updatedTasks);
            };

            const deleteTask = async (id) => {
                const updatedTasks = tasks.filter(t => t.id !== id);
                setTasks(updatedTasks);
                await saveData('tasks', updatedTasks);
            };

            const addWeather = async () => {
                if (!selectedWeather || !username.trim()) return;
                
                const existing = weather.find(w => w.username === username);
                let updatedWeather;
                
                if (existing) {
                    updatedWeather = weather.map(w => 
                        w.username === username ? { ...w, weather: selectedWeather } : w
                    );
                } else {
                    updatedWeather = [...weather, { username, weather: selectedWeather }];
                }
                
                setWeather(updatedWeather);
                await saveData('weather', updatedWeather);
                setSelectedWeather('');
            };

            const addMood = async () => {
                if (!selectedMood || !username.trim()) return;
                
                const existing = moods.find(m => m.username === username);
                let updatedMoods;
                
                if (existing) {
                    updatedMoods = moods.map(m => 
                        m.username === username ? { ...m, mood: selectedMood } : m
                    );
                } else {
                    updatedMoods = [...moods, { username, mood: selectedMood }];
                }
                
                setMoods(updatedMoods);
                await saveData('moods', updatedMoods);
                setSelectedMood('');
            };

            const getWeatherCount = (weatherId) => {
                return weather.filter(w => w.weather === weatherId).length;
            };

            const getMoodCount = (moodId) => {
                return moods.filter(m => m.mood === moodId).length;
            };

            if (loading) {
                return <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900 flex items-center justify-center text-white text-xl">Chargement...</div>;
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900 p-8">
                    <div className="max-w-6xl mx-auto space-y-8">
                        
                        <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-6 border border-white border-opacity-20">
                            <h2 className="text-2xl font-bold text-white mb-4">üë§ Votre Profil</h2>
                            <div className="flex flex-wrap gap-4">
                                <input
                                    type="text"
                                    placeholder="Votre pseudo Twitch"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    className="flex-1 min-w-[200px] px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-purple-400"
                                />
                                <label className="flex items-center gap-2 text-white cursor-pointer">
                                    <input
                                        type="checkbox"
                                        checked={isFollower}
                                        onChange={(e) => setIsFollower(e.target.checked)}
                                        className="w-5 h-5 rounded"
                                    />
                                    <span>Je suis follower</span>
                                </label>
                            </div>
                        </div>

                        {isFollower && username && (
                            <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-6 border border-white border-opacity-20">
                                <h2 className="text-2xl font-bold text-white mb-4">üìã T√¢ches des Followers</h2>
                                
                                <div className="flex gap-2 mb-4">
                                    <input
                                        type="text"
                                        placeholder="Ajouter une t√¢che..."
                                        value={newTask}
                                        onChange={(e) => setNewTask(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addTask()}
                                        className="flex-1 px-4 py-2 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60 border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-purple-400"
                                    />
                                    <button
                                        onClick={addTask}
                                        className="px-6 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition flex items-center gap-2"
                                    >
                                        <Plus />
                                        Ajouter
                                    </button>
                                </div>

                                <div className="space-y-2">
                                    {tasks.map(task => (
                                        <div
                                            key={task.id}
                                            className="flex items-center gap-3 p-3 bg-white bg-opacity-10 rounded-lg border border-white border-opacity-20"
                                        >
                                            <button
                                                onClick={() => toggleTask(task.id)}
                                                className={`p-2 rounded-lg transition ${
                                                    task.completed ? 'bg-green-500 text-white' : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                                                }`}
                                            >
                                                <Check />
                                            </button>
                                            <div className="flex-1">
                                                <p className={`text-white ${task.completed ? 'line-through opacity-60' : ''}`}>
                                                    {task.text}
                                                </p>
                                                <p className="text-sm text-purple-300">par {task.author}</p>
                                            </div>
                                            <button
                                                onClick={() => deleteTask(task.id)}
                                                className="p-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition"
                                            >
                                                <Trash2 />
                                            </button>
                                        </div>
                                    ))}
                                    {tasks.length === 0 && (
                                        <p className="text-white text-opacity-60 text-center py-4">Aucune t√¢che pour le moment</p>
                                    )}
                                </div>
                            </div>
                        )}

                        <div className="grid md:grid-cols-2 gap-8">
                            <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-6 border border-white border-opacity-20">
                                <h2 className="text-2xl font-bold text-white mb-4">üå§Ô∏è M√©t√©o de la Communaut√©</h2>
                                
                                {username && (
                                    <div className="mb-4">
                                        <div className="grid grid-cols-2 gap-2 mb-3">
                                            {weatherOptions.map(option => (
                                                <button
                                                    key={option.id}
                                                    onClick={() => {
                                                        setSelectedWeather(option.id);
                                                        setTimeout(() => {
                                                            addWeather();
                                                        }, 100);
                                                    }}
                                                    className={`p-3 rounded-lg transition flex items-center gap-2 ${
                                                        selectedWeather === option.id
                                                            ? 'bg-purple-500 text-white'
                                                            : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                                                    }`}
                                                >
                                                    <option.icon />
                                                    <span className="text-sm">{option.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="space-y-2">
                                    {weatherOptions.map(option => {
                                        const count = getWeatherCount(option.id);
                                        return count > 0 ? (
                                            <div key={option.id} className="flex items-center justify-between p-3 bg-white bg-opacity-10 rounded-lg">
                                                <div className="flex items-center gap-2">
                                                    <option.icon />
                                                    <span className="text-white">{option.label}</span>
                                                </div>
                                                <span className="text-white font-bold text-xl">{count}</span>
                                            </div>
                                        ) : null;
                                    })}
                                </div>
                            </div>

                            <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-6 border border-white border-opacity-20">
                                <h2 className="text-2xl font-bold text-white mb-4">üòä Humeur de la Communaut√©</h2>
                                
                                {username && (
                                    <div className="mb-4">
                                        <div className="grid grid-cols-2 gap-2 mb-3">
                                            {moodOptions.map(option => (
                                                <button
                                                    key={option.id}
                                                    onClick={() => {
                                                        setSelectedMood(option.id);
                                                        setTimeout(() => {
                                                            addMood();
                                                        }, 100);
                                                    }}
                                                    className={`p-3 rounded-lg transition flex items-center gap-2 ${
                                                        selectedMood === option.id
                                                            ? 'bg-purple-500 text-white'
                                                            : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                                                    }`}
                                                >
                                                    <option.icon />
                                                    <span className="text-sm">{option.label}</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <div className="space-y-2">
                                    {moodOptions.map(option => {
                                        const count = getMoodCount(option.id);
                                        return count > 0 ? (
                                            <div key={option.id} className="flex items-center justify-between p-3 bg-white bg-opacity-10 rounded-lg">
                                                <div className="flex items-center gap-2">
                                                    <option.icon />
                                                    <span className="text-white">{option.label}</span>
                                                </div>
                                                <span className="text-white font-bold text-xl">{count}</span>
                                            </div>
                                        ) : null;
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TwitchScene />, document.getElementById('root'));
    </script>
</body>
</html>
